From 5215ac33ead90294d79da36f26f58ef86d0b6c00 Mon Sep 17 00:00:00 2001
From: JorgeMHC-dev <miguel.hernandez@wizeline.com>
Date: Fri, 19 May 2023 11:26:50 -0600
Subject: [PATCH] Added backend call

---
 package-lock.json               |  15 ++++
 package.json                    |   1 +
 server/index.js                 |   4 +
 server/routes/user.routes.js    |  17 ++--
 server/utils/insertFunctions.js |  44 ++++++++++
 src/App.js                      |  18 +++-
 src/components/Esignin.js       | 146 --------------------------------
 src/components/FormAlumno.jsx   | 108 +++++++++++++++++++++++
 src/components/FormEmpresa.jsx  |  87 +++++++++++++++++++
 src/components/LogIn.js         |  10 ++-
 src/components/Signin.js        | 140 +++++++-----------------------
 11 files changed, 322 insertions(+), 268 deletions(-)
 create mode 100644 server/utils/insertFunctions.js
 delete mode 100644 src/components/Esignin.js
 create mode 100644 src/components/FormAlumno.jsx
 create mode 100644 src/components/FormEmpresa.jsx

diff --git a/package-lock.json b/package-lock.json
index ca16777..cc5c40c 100644
--- a/package-lock.json
+++ b/package-lock.json
@@ -22,6 +22,7 @@
         "react-dom": "^18.2.0",
         "react-router-dom": "^6.11.0",
         "react-scripts": "5.0.1",
+        "uuidv4": "^6.2.13",
         "web-vitals": "^2.1.4"
       },
       "devDependencies": {
@@ -4304,6 +4305,11 @@
       "resolved": "https://registry.npmjs.org/@types/trusted-types/-/trusted-types-2.0.3.tgz",
       "integrity": "sha512-NfQ4gyz38SL8sDNrSixxU2Os1a5xcdFxipAFxYEuLUlvU2uDwS4NUpsImcf1//SlWItCVMMLiylsxbmNMToV/g=="
     },
+    "node_modules/@types/uuid": {
+      "version": "8.3.4",
+      "resolved": "https://registry.npmjs.org/@types/uuid/-/uuid-8.3.4.tgz",
+      "integrity": "sha512-c/I8ZRb51j+pYGAu5CrFMRxqZ2ke4y2grEBO5AUjgSkSk+qT2Ea+OdWElz/OiMf5MNpn2b17kuVBwZLQJXzihw=="
+    },
     "node_modules/@types/ws": {
       "version": "8.5.4",
       "resolved": "https://registry.npmjs.org/@types/ws/-/ws-8.5.4.tgz",
@@ -16990,6 +16996,15 @@
         "uuid": "dist/bin/uuid"
       }
     },
+    "node_modules/uuidv4": {
+      "version": "6.2.13",
+      "resolved": "https://registry.npmjs.org/uuidv4/-/uuidv4-6.2.13.tgz",
+      "integrity": "sha512-AXyzMjazYB3ovL3q051VLH06Ixj//Knx7QnUSi1T//Ie3io6CpsPu9nVMOx5MoLWh6xV0B9J0hIaxungxXUbPQ==",
+      "dependencies": {
+        "@types/uuid": "8.3.4",
+        "uuid": "8.3.2"
+      }
+    },
     "node_modules/v8-to-istanbul": {
       "version": "8.1.1",
       "resolved": "https://registry.npmjs.org/v8-to-istanbul/-/v8-to-istanbul-8.1.1.tgz",
diff --git a/package.json b/package.json
index 5ad5895..18ccd66 100644
--- a/package.json
+++ b/package.json
@@ -17,6 +17,7 @@
     "react-dom": "^18.2.0",
     "react-router-dom": "^6.11.0",
     "react-scripts": "5.0.1",
+    "uuidv4": "^6.2.13",
     "web-vitals": "^2.1.4"
   },
   "scripts": {
diff --git a/server/index.js b/server/index.js
index 0726269..045d273 100644
--- a/server/index.js
+++ b/server/index.js
@@ -1,20 +1,24 @@
 const express = require("express");
 const dotenv = require("dotenv");
 const bodyParser = require('body-parser');
+const cors = require('cors');
 // importar las variables de entorno
 dotenv.config();
  
 // importar las rutas
 const taskRoutes = require('./routes/skillup.routes')
+const userRoutes = require('./routes/user.routes')
 
 const app = express();
 
 const port = process.env.PORT;
 
+app.use(cors())
 app.use(bodyParser.urlencoded({ extended: true }));
 app.use(bodyParser.json());
 
 app.use(taskRoutes)
+app.use(userRoutes)
 
 app.listen(port);
 
diff --git a/server/routes/user.routes.js b/server/routes/user.routes.js
index 76331b0..e2265fa 100644
--- a/server/routes/user.routes.js
+++ b/server/routes/user.routes.js
@@ -1,12 +1,19 @@
 const { Router } = require("express");
+const pool = require("../database/database");
+const insertUser = require('../utils/insertFunctions')
 const router = Router();
 
+
+
 router.post("/registro", async (req, res) => {
     const datAlumn =req.body;
-    console.log(datAlumn)
+    const response = insertUser(pool, datAlumn)
+    res.status(200).send(response)
   });
 
-  router.post("/Login", async (req, res) => {
-    const datAlumn =req.body;
-    console.log(datAlumn)
-  });
\ No newline at end of file
+router.post("/Login", async (req, res) => {
+  const datAlumn =req.body;
+  res.status(200).send({ data: datAlumn, message: 'Successfully logedIn'})
+});
+
+module.exports = router;
\ No newline at end of file
diff --git a/server/utils/insertFunctions.js b/server/utils/insertFunctions.js
new file mode 100644
index 0000000..d2a0165
--- /dev/null
+++ b/server/utils/insertFunctions.js
@@ -0,0 +1,44 @@
+const uuidv4 = require('uuidv4')
+
+async function insertarUsuario(pool, user) {
+  try {
+    const nuevoUsuario = {
+      id_alumno: uuidv4.uuid(),
+      contrasena: user.password,
+      nombre: user.nombre,
+      apellido: user.apellido,
+      universidad: user.universidad,
+      carrera: user.carrera,
+      descripcion: 'Descripción del usuario',
+      id_grado: 2,
+      correo: user.correo,
+      sexo: 'M',
+      fecha_nacimiento: user.fecha,
+    };
+
+    const query = 'INSERT INTO skillup.alumno (id_alumno, contrasena, nombre, apellido, universidad, carrera, descripcion, id_grado, correo, sexo, fecha_nacimiento) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11)';
+    const values = [
+      nuevoUsuario.id_alumno,
+      nuevoUsuario.contrasena,
+      nuevoUsuario.nombre,
+      nuevoUsuario.apellido,
+      nuevoUsuario.universidad,
+      nuevoUsuario.carrera,
+      nuevoUsuario.descripcion,
+      nuevoUsuario.id_grado,
+      nuevoUsuario.correo,
+      nuevoUsuario.sexo,
+      nuevoUsuario.fecha_nacimiento,
+    ];
+
+    const client = await pool.connect();
+    await client.query(query, values);
+    client.release();
+
+    return {message: 'Usuario insertado correctamente', status: 200}
+  } catch (error) {
+    console.error('Error al insertar el usuario:', error);
+  }
+}
+
+module.exports = insertarUsuario
\ No newline at end of file
diff --git a/src/App.js b/src/App.js
index 1b568ec..40d3044 100644
--- a/src/App.js
+++ b/src/App.js
@@ -1,16 +1,30 @@
-import React from "react";
+import React, { useState } from "react";
 import Navbar from "./components/Navbar";
 import LogIn from "./components/LogIn";
 import Footer from "./components/Footer";
 
 import './App.css'
+import Signin from "./components/Signin";
 
 
 function App() {
+  const [view, setView] = useState(0)
+
+  const getView = () => {
+    switch (view) {
+      case 0:
+        return <LogIn setView={setView}/>
+      case 1: 
+        return <Signin />
+      default:
+        break;
+    }
+  }
+
   return (
     <div className="App">
       <Navbar />
-      <LogIn/>
+        {getView()}
       <Footer />
     </div>
   );
diff --git a/src/components/Esignin.js b/src/components/Esignin.js
deleted file mode 100644
index aff2fbb..0000000
--- a/src/components/Esignin.js
+++ /dev/null
@@ -1,146 +0,0 @@
-import React from "react";
-import { useState } from "react";
-
-function Esignin() {
-  const [company, setCompany] = useState({
-    nombre: " ",
-    direccion: " ",
-    RFC: " ",
-    correo: "",
-    password: "",
-    confPassword: "",
-  });
-
-  const handleChange = (e) => {
-    const { name, value } = e.target;
-    setCompany({ ...company, [name]: value });
-  };
-
-  const handleClick = () => {
-    fetch("/registro", {
-      method: "POST",
-      headers: {
-        "Content-Type": "application/json",
-      },
-      body: JSON.stringify({ ...company }),
-    })
-      .then((response) => response.json())
-      .then((data) => {
-        setCompany(data);
-      })
-      .catch((error) => {
-        console.error("Error:", error);
-      });
-  };
-
-  return (
-
-      <div className="container mb-4">
-        <form className="form-signin">
-          <div className="text-center mb-4">
-            <h3 className="text-white">SkillUp!</h3>
-          </div>
-
-          <div
-            class="btn-group mb-8 d-flex align-items-center"
-            role="group"
-            aria-label="Basic example"
-          >
-            <button type="button" class="btn btn-outline-secondary">
-              Alumno
-            </button>
-            <button type="button" class="btn btn-secondary active">
-              Empresa
-            </button>
-          </div>
-
-          <div className="form-label-group" class="mt-5">
-            <input
-              type="name"
-              id="inputName"
-              className="form-control bg-transparent text-white"
-              placeholder="Nombre de la empresa"
-              required
-              autofocus
-              onChange={handleChange}
-            />
-            <label for="inputName"></label>
-          </div>
-
-          <div className="form-label-group">
-            <input
-              type="direccion"
-              id="inputDireccion"
-              className="form-control bg-transparent text-white"
-              placeholder="Direccion de la empresa"
-              required
-              autofocus
-              onChange={handleChange}
-            />
-            <label for="inputDireccion">Direccion</label>
-          </div>
-
-          <div className="form-label-group">
-            <input
-              type="RFC"
-              id="inputRFC"
-              className="form-control bg-transparent text-white"
-              placeholder="RFC"
-              required
-              autofocus
-              onChange={handleChange}
-            />
-            <label for="inputRFC">RFC</label>
-          </div>
-
-          <div className="form-label-group">
-            <input
-              type="email"
-              id="inputEmail"
-              className="form-control bg-transparent text-white"
-              placeholder="Correo"
-              required
-              autofocus
-              onChange={handleChange}
-            />
-            <label for="inputEmail">Correo</label>
-          </div>
-
-          <div className="form-label-group">
-            <input
-              type="password"
-              id="inputPassword"
-              className="form-control bg-transparent text-white"
-              placeholder="Contraseña"
-              required
-              onChange={handleChange}
-            />
-            <label for="inputPassword">Contraseña</label>
-          </div>
-
-          <div className="form-label-group">
-            <input
-              type="password"
-              id="inputConfirmationPassword"
-              className="form-control bg-transparent text-white"
-              placeholder="Confirmar contraseña"
-              required
-              onChange={handleChange}
-            />
-            <label for="inputConfirmationPassword">Confirmar contraseña</label>
-          </div>
-
-          <button
-            className="btn btn-lg btn-outline-secondary btn-block"
-            type="submit "
-            onClick={handleClick}
-          >
-            Registro
-          </button>
-        </form>
-      </div>
-   
-  );
-}
-
-export default Esignin;
diff --git a/src/components/FormAlumno.jsx b/src/components/FormAlumno.jsx
new file mode 100644
index 0000000..000249d
--- /dev/null
+++ b/src/components/FormAlumno.jsx
@@ -0,0 +1,108 @@
+export const FormAlumno = ({handleChange}) => {
+  return (
+    <>
+      <div className="form-label-group">
+        <input
+          type="name"
+          id="inputName"
+          className="form-control bg-transparent text-light"
+          placeholder="Nombre/s"
+          required
+          autofocus
+          name="nombres"
+          onChange={handleChange}
+        />
+        <label for="inputName">Nombres</label>
+      </div>
+      <div className="form-label-group">
+        <input
+          type="lastNames"
+          id="inputLastNames"
+          className="form-control bg-transparent text-light"
+          placeholder="Apellidos"
+          name="apellidos"
+          required
+          autofocus
+          onChange={handleChange}
+        />
+        <label for="inputLastNames">Apellidos</label>
+      </div>
+      <div className="form-label-group">
+        <input
+          type="Date"
+          id="inputFecha"
+          className="form-control bg-transparent text-secondary"
+          placeholder="Fecha"
+          name="fecha"
+          required
+          autofocus
+          onChange={handleChange}
+        />
+        <label for="inputFecha">Fecha</label>
+      </div>
+      <div className="form-label-group">
+        <input
+          type="career"
+          id="inputCareer"
+          className="form-control bg-transparent text-light"
+          placeholder="Carrera"
+          name="carrera"
+          required
+          autofocus
+          onChange={handleChange}
+        />
+        <label for="inputCareer">Carrera</label>
+      </div>
+      <div className="form-label-group">
+        <input
+          type="University"
+          id="inputUniversity"
+          className="form-control bg-transparent text-light"
+          placeholder="Universidad"
+          name="universidad"
+          required
+          autofocus
+          onChange={handleChange}
+        />
+        <label for="inputUniversity">Universidad</label>
+      </div>
+      <div className="form-label-group">
+        <input
+          type="email"
+          id="inputEmail"
+          className="form-control bg-transparent text-light"
+          placeholder="Correo"
+          name="correo"
+          required
+          autofocus
+          onChange={handleChange}
+        />
+        <label for="inputEmail">Correo</label>
+      </div>
+      <div className="form-label-group">
+        <input
+          type="password"
+          id="inputPassword"
+          className="form-control bg-transparent text-light"
+          placeholder="Contraseña"
+          name="password"
+          required
+          onChange={handleChange}
+        />
+        <label for="inputPassword">Contraseña</label>
+      </div>
+      <div className="form-label-group">
+        <input
+          type="password"
+          id="inputConfirmationPassword"
+          className="form-control bg-transparent text-light"
+          placeholder="Confirmar contraseña"
+          name="confpassword"
+          required
+          onChange={handleChange}
+        />
+        <label for="inputConfirmationPassword">Confirmar contraseña</label>
+      </div>
+    </>
+  )
+}
\ No newline at end of file
diff --git a/src/components/FormEmpresa.jsx b/src/components/FormEmpresa.jsx
new file mode 100644
index 0000000..a9e386a
--- /dev/null
+++ b/src/components/FormEmpresa.jsx
@@ -0,0 +1,87 @@
+export const FormEmpresa = ({handleChange}) => {
+  return (
+    <>
+      <div className="form-label-group" class="mt-5">
+        <input
+          type="name"
+          id="inputName"
+          className="form-control bg-transparent text-white"
+          placeholder="Nombre de la empresa"
+          name="nombre"
+          required
+          autofocus
+          onChange={handleChange}
+        />
+        <label for="inputName"></label>
+      </div>
+
+      <div className="form-label-group">
+        <input
+          type="direccion"
+          id="inputDireccion"
+          className="form-control bg-transparent text-white"
+          placeholder="Direccion de la empresa"
+          name="direccion"
+          required
+          autofocus
+          onChange={handleChange}
+        />
+        <label for="inputDireccion">Direccion</label>
+      </div>
+
+      <div className="form-label-group">
+        <input
+          type="RFC"
+          id="inputRFC"
+          className="form-control bg-transparent text-white"
+          placeholder="RFC"
+          name="RFC"
+          required
+          autofocus
+          onChange={handleChange}
+        />
+        <label for="inputRFC">RFC</label>
+      </div>
+
+      <div className="form-label-group">
+        <input
+          type="email"
+          id="inputEmail"
+          className="form-control bg-transparent text-white"
+          placeholder="Correo"
+          name="correo"
+          required
+          autofocus
+          onChange={handleChange}
+        />
+        <label for="inputEmail">Correo</label>
+      </div>
+
+      <div className="form-label-group">
+        <input
+          type="password"
+          id="inputPassword"
+          className="form-control bg-transparent text-white"
+          placeholder="Contraseña"
+          name="password"
+          required
+          onChange={handleChange}
+        />
+        <label for="inputPassword">Contraseña</label>
+      </div>
+
+      <div className="form-label-group">
+        <input
+          type="password"
+          id="inputConfirmationPassword"
+          className="form-control bg-transparent text-white"
+          placeholder="Confirmar contraseña"
+          name="confpassword"
+          required
+          onChange={handleChange}
+        />
+        <label for="inputConfirmationPassword">Confirmar contraseña</label>
+      </div>
+    </>
+  )
+}
\ No newline at end of file
diff --git a/src/components/LogIn.js b/src/components/LogIn.js
index 5741825..6454013 100644
--- a/src/components/LogIn.js
+++ b/src/components/LogIn.js
@@ -1,7 +1,7 @@
 import React from "react";
 import { useState } from "react";
 
-function LogIn() {
+const LogIn = ({setView}) => {
   const [Log, setLog] = useState({
     correo: "",
     password: "",
@@ -13,7 +13,7 @@ function LogIn() {
   };
 
   const handleClick = () => {
-    fetch("/Login", {
+    fetch("http://localhost:3001/Login", {
       method: "POST",
       headers: {
         "Content-Type": "application/json",
@@ -22,7 +22,7 @@ function LogIn() {
     })
       .then((response) => response.json())
       .then((data) => {
-        setLog(data);
+        console.log(data)
       })
       .catch((error) => {
         console.error("Error:", error);
@@ -45,6 +45,7 @@ function LogIn() {
             class="form-control bg-light"
             type="text"
             placeholder="Email"
+            name="correo"
             required
             autofocus
             onChange={handleChange}
@@ -55,6 +56,7 @@ function LogIn() {
           <input
             class="form-control bg-light"
             type="password"
+            name="password"
             placeholder="contraseña"
             required
             autofocus
@@ -79,7 +81,7 @@ function LogIn() {
           </div>
         </div>
         <div class="btn btn-secondary d-flex gap-2 justify-content-center border mt-2 shadow-sm">
-          <div class="fw-semibold text-white">soy un usuario nuevo</div>
+          <div onClick={() => setView(1)} class="fw-semibold text-white">soy un usuario nuevo</div>
         </div>
       </div>
     </div>
diff --git a/src/components/Signin.js b/src/components/Signin.js
index 4517a15..df2612f 100644
--- a/src/components/Signin.js
+++ b/src/components/Signin.js
@@ -1,8 +1,18 @@
 import React from "react";
-import {useState} from "react";
+import { useState } from "react";
+import { FormAlumno } from "./FormAlumno";
+import { FormEmpresa } from "./FormEmpresa";
 
 function Signin() {
-  
+  const [company, setCompany] = useState({
+    nombre: " ",
+    direccion: " ",
+    RFC: " ",
+    correo: "",
+    password: "",
+    confPassword: "",
+  });
+
   const [user, setUser] = useState({
     nombres:" ",
     apellidos:" ",
@@ -13,23 +23,31 @@ function Signin() {
     password:"",
     confPassword:""
   });
+
+  const [studentForm, setStudentForm] = useState(true)
+  
+  const handleCompanyChange = (e) => {
+    const { name, value } = e.target;
+    setCompany({ ...company, [name]: value });
+  };
   
-  const handleChange = (e) => {
+  const handleStudentChange = (e) => {
     const { name, value } = e.target;
     setUser({ ...user, [name]: value });
   };
 
   const handleClick = () => {
-    fetch('/registro', {
+    const body = studentForm ? user : company
+    fetch('http://localhost:3001/registro', {
       method: 'POST',
       headers: {
         'Content-Type': 'application/json'
       },
-      body: JSON.stringify({...user})
+      body: JSON.stringify(body)
     })
       .then(response => response.json())
       .then(data => {
-        setUser(data);
+        console.log(data)
       })
       .catch(error => {
         console.error('Error:', error);
@@ -44,116 +62,16 @@ function Signin() {
         </div>
 
         <div class="btn-group mb-4 d-flex align-items-center" role="group" aria-label="Basic example">
-          <button type="button" class="btn btn-secondary active">
+          <button type="button" className={studentForm ? "btn btn-secondary active" : "btn btn-outline-secondary"} onClick={()=>setStudentForm(true)}>
             Alumno
           </button>
-          <button type="button" class="btn btn-outline-secondary">
+          <button type="button" className={!studentForm ? "btn btn-secondary active" : "btn btn-outline-secondary"} onClick={()=>setStudentForm(false)}>
             Empresa
           </button>
         </div>
-
-        <div className="form-label-group">
-          <input
-            type="name"
-            id="inputName"
-            className="form-control bg-transparent text-light"
-            placeholder="Nombre/s"
-            required
-            autofocus
-            onChange={handleChange}
-          />
-          <label for="inputName">Nombres</label>
-        </div>
-        <div className="form-label-group">
-          <input
-            type="lastNames"
-            id="inputLastNames"
-            className="form-control bg-transparent text-light"
-            placeholder="Apellidos"
-            required
-            autofocus
-            onChange={handleChange}
-          />
-          <label for="inputLastNames">Apellidos</label>
-        </div>
-
-        <div className="form-label-group">
-          <input
-            type="Date"
-            id="inputFecha"
-            className="form-control bg-transparent text-secondary"
-            placeholder="Fecha"
-            required
-            autofocus
-            onChange={handleChange}
-          />
-          <label for="inputFecha">Fecha</label>
-        </div>
-
-        <div className="form-label-group">
-          <input
-            type="career"
-            id="inputCareer"
-            className="form-control bg-transparent text-light"
-            placeholder="Carrera"
-            required
-            autofocus
-            onChange={handleChange}
-          />
-          <label for="inputCareer">Carrera</label>
-        </div>
-
-        <div className="form-label-group">
-          <input
-            type="University"
-            id="inputUniversity"
-            className="form-control bg-transparent text-light"
-            placeholder="Universidad"
-            required
-            autofocus
-            onChange={handleChange}
-          />
-          <label for="inputUniversity">Universidad</label>
-        </div>
-
-        <div className="form-label-group">
-          <input
-            type="email"
-            id="inputEmail"
-            className="form-control bg-transparent text-light"
-            placeholder="Correo"
-            required
-            autofocus
-            onChange={handleChange}
-          />
-          <label for="inputEmail">Correo</label>
-        </div>
-
-        <div className="form-label-group">
-          <input
-            type="password"
-            id="inputPassword"
-            className="form-control bg-transparent text-light"
-            placeholder="Contraseña"
-            required
-            onChange={handleChange}
-          />
-          <label for="inputPassword">Contraseña</label>
-        </div>
-
-
-        <div className="form-label-group">
-          <input
-            type="password"
-            id="inputConfirmationPassword"
-            className="form-control bg-transparent text-light"
-            placeholder="Confirmar contraseña"
-            required
-            onChange={handleChange}
-          />
-          <label for="inputConfirmationPassword">Confirmar contraseña</label>
-        </div>
-
+        {studentForm ? 
+          <FormAlumno handleChange={handleStudentChange} />
+        : <FormEmpresa handleChange={handleCompanyChange} />}
         <button
           className="btn btn-lg btn-outline-secondary btn-block"
           type="submit "
-- 
2.39.2 (Apple Git-143)

